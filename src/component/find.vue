<template>
	<div class="page-loadmore">
		<div class="page-loadmore-wrapper" ref="wrapper" :style="{ height: wrapperHeight + 'px' }">
			<mt-loadmore :bottom-method="loadBottom" @bottom-status-change="handleBottomChange" :bottom-all-loaded="allLoaded" ref="loadmore">
				<ul class="page-loadmore-list">
					<li v-for="item in list" class="page-loadmore-listitem">{{ item }}</li>
				</ul>
				<div slot="bottom" class="mint-loadmore-bottom">
					<span v-show="bottomStatus !== 'loading'" :class="{ 'is-rotate': bottomStatus === 'drop' }">â†‘</span>
					<span v-show="bottomStatus === 'loading'">
			            <mt-spinner type="snake"></mt-spinner>
			        </span>
				</div>
			</mt-loadmore>
		</div>
		<footer-bar></footer-bar>
	</div>
</template>

<style>
	.mint-loadmore{
	  	overflow: visible;
	}
</style>

<script type="text/babel">
	import footerbar from './tab.vue';
	export default {
		data() {
			return {
				list: [],
				allLoaded: false,
				bottomStatus: '',
				wrapperHeight: 0
			};
		},
		components: {
			"footer-bar": footerbar
		},
		methods: {
			handleBottomChange(status) {
				this.bottomStatus = status;
			},
			loadBottom() {
				setTimeout(() => {
					let lastValue = this.list[this.list.length - 1];
					if(lastValue < 40) {
						for(let i = 1; i <= 10; i++) {
							this.list.push(lastValue + i);
						}
					} else {
						this.allLoaded = true;
					}
					this.$refs.loadmore.onBottomLoaded();
				}, 500);
			}
		},
		created() {
			for(let i = 1; i <= 20; i++) {
				this.list.push(i);
			}
		},
		mounted() {
			this.wrapperHeight = document.documentElement.clientHeight - this.$refs.wrapper.getBoundingClientRect().top;
		}
	};
</script>
